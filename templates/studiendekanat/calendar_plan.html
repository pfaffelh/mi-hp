{% extends "base_nlehre.html" %} {% block styles %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"
  integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet"><style>
  .fc .fc-col-header-cell-cushion {
    display: inline-block;
    padding: 2px 4px;
  }

  .fc-event {
    margin-top: 0px;
    margin-bottom: 0px;
  }

  #calendar {
    max-width: 900px;
    margin: 40px auto;
  }

  .calendar-toggle-group .btn {
    color: white;
    border: none;
  }

  {% for c in calendars %}
  .btn-{{ c["kurzname"] }} {
    background-color: {{ c["color"] }}
  }
  {% endfor %}

  .btn-off {
    background-color: #e0e0e0 !important;
    color: black !important;
  }
</style>
{% endblock %} {% block navbar %} {% include 'navbar_nlehre.html' %} {% endblock %} {%
block content %}
<div class="container">
  <h4>{% if lang == "de" %}WÃ¤hle Kalender{% else %}Choose calendar{% endif %}</h4>
  <div class="btn-group calendar-toggle-group mb-4" role="group" id="calendarToggles">
    {% for c in calendars %}
    <button type="button" class="btn {% if c['kurzname'] != 'semesterplan' %}btn-off{% endif %}" data-calendar={{ c['kurzname'] }}"work">{% if lang == 'de' %} {{ c['name_de'] }}  {% else %} {{ c['name_en'] }} {% endif %} </button>
    {% endfor %}
  </div>


  <h3>Semesterplanung</h3>
<!--  <h4>Verantwortliche</h4>
</div>
<div class="container" style="max-width: 140vh">
  {% for u in faq_users %}
  <div class="row">
    <div class="col-1 mx-3" style="background: {{ u['color'] }}; color: {{ u['color'] }}; ">d</div>
    <div class="col-4">{{ u["vorname"] }} {{ u["name"] }}</div>
  </div>
  {% endfor %}
</div>-->
<br />

<div class="container" style="max-width: 140vh">
  <div id="calendar"></div>
</div>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/bootstrap5@6.1.11/index.global.min.js"></script>
<script src="fullcalendar/core/index.global.js"></script>
<script src="fullcalendar/core/locales/de.global.js"></script>
<script>
  function formatTimeIfNotMidnight(isoString) {
    const date = new Date(isoString);
    const hours = date.getHours();
    const minutes = date.getMinutes();

    if (hours === 0 && minutes === 0) {
      return ""; // Keine Uhrzeit anzeigen
    } else {
      return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
    }
  }
</script>
<script>
  function formatEvent(event) {
    const s = `${String(event.start.getHours()).padStart(2, '0')}:${String(event.start.getMinutes()).padStart(2, '0')}`
    const e = `${String(event.end.getHours()).padStart(2, '0')}:${String(event.end.getMinutes()).padStart(2, '0')}`

    if (event.start.getHours() === 0 && event.start.getMinutes() === 0) {
      return info.event.title; // Keine Uhrzeit anzeigen
    } else {
      if (s == e) {
        return `${s}: ` + info.event.title;
      } else {
        return `${s}-${e}: ` + info.event.title;
      }
    }
  }
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const calendarEl = document.getElementById("calendar");    
    const calendarColors = {
      {% for c in calendars %} "{{ c['kurzname'] }}" : "{{ c['color']}}", {% endfor %}
    };

    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      timeZone: "local",
      locale: "de",
      expandRows: true,
      buttonText: {
        today: "heute",
        month: "Monat",
        week: "Woche",
        day: "Tag",
        list: "Liste"
      },
      firstDay: 1,
      themeSystem: 'bootstrap5',
      headerToolbar: {
        left: "prev,next,today",
        center: "title",
        right: "dayGridMonth,timeGridWeek,timeGridDay,listMonth",
      },
      weekNumbers: true,
      dayMaxEvents: true, // allow "more" link when too many events
      eventTimeFormat: { // like '14:30:00'
        hour: '2-digit',
        minute: '2-digit',
        meridiem: false
      },
      eventClick: function(info) {
          alert(info.event.extendedProps.description);
      },
      events: [
        {% for event in events %}
            {
              start: '{{ event.start}}',
              end: '{{ event.end }}',
              allDay: '{{ event.allDay}}',
              title: '{{ event.title}}',
              backgroundColor: '{{ event.color}}',
              textColor: '{{ event.textcolor}}',
              extendedProps: {
                description: '{{ event.extendedProps.description}}',
      }
            },
            {% endfor %}
          ],
      eventDidMount: function(info) {
         info.el.setAttribute("title", info.event.extendedProps.description);
  }    });
    calendar.render();
  });
</script>
{% endblock %}